<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>无标题文档</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        p {
            font-family: 'Open Sans';
            margin: 0;
            font-size: 13px;
        }

        .auto_hidden {

            width: 204px;
            border-top: 1px solid #333;

            border-bottom: 1px solid #333;

            border-left: 1px solid #333;

            border-right: 1px solid #333;

            position: absolute;

            background-color: #29ffe7;

            height: 300px;

            display: none;

        }

        .auto_show {

            width: 204px;

            border-top: 1px solid #333;

            border-bottom: 1px solid #333;

            border-left: 1px solid #333;

            border-right: 1px solid #333;

            position: absolute;

            z-index: 9999; /* 设置对象的层叠顺序 */

            display: block;

        }

        .auto_onmouseover {

            color: #212cff;

            background-color: highlight;

            width: 100%;

        }

        .auto_onmouseout {

            color: #000000;

            width: 100%;

            background-color: #ffffff;

        }
        .tip {
            position: relative;
            background-color: deepskyblue;
            margin:  0 0 10px 0 ;
            top:30px;
            left:20px;
            width: 300px;
            height: 60px;
            color: white;
            text-align: center;
            padding:30px 0 0 0;
            border-radius: 10px;
            font-family: sans-serif;
        }
        .tip:after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border: 8px solid;
        }
        .top:after {
            border-bottom-color: deepskyblue;
            left: 50%;
            bottom: 100%;
            margin-left: -15px;
        }




    </style>
    <link href="liuk.css" rel="stylesheet" type="text/css"/>
    <script language="javascript">

        <!--

        var $ = function (id) {

            return "string" == typeof id ? document.getElementById(id) : id;

        }

        var Bind = function (object, fun) {

            return function () {

                return fun.apply(object, arguments);

            }

        }

        function AutoComplete(obj, autoObj, arr) {

            this.obj = $(obj);        //输入框

            this.autoObj = $(autoObj);//DIV的根节点

            this.value_arr = arr;        //不要包含重复值

            this.index = -1;          //当前选中的DIV的索引

            this.search_value = "";   //保存当前搜索的字符

        }

        AutoComplete.prototype = {

            //初始化DIV的位置

            init: function () {

                this.autoObj.style.left = this.obj.offsetLeft + "px";

                this.autoObj.style.top = this.obj.offsetTop + this.obj.offsetHeight + "px";

                this.autoObj.style.width = this.obj.offsetWidth - 2 + "px";//减去边框的长度2px

            },

            //删除自动完成需要的所有DIV

            deleteDIV: function () {

                while (this.autoObj.hasChildNodes()) {

                    this.autoObj.removeChild(this.autoObj.firstChild);

                }

                this.autoObj.className = "auto_hidden";

            },

            //设置值

            setValue: function (_this) {

                return function () {

                    _this.obj.value = this.seq;

                    _this.autoObj.className = "auto_hidden";

                }

            },

            //模拟鼠标移动至DIV时，DIV高亮

            autoOnmouseover: function (_this, _div_index) {

                return function () {

                    _this.index = _div_index;

                    var length = _this.autoObj.children.length;

                    for (var j = 0; j < length; j++) {

                        if (j != _this.index) {

                            _this.autoObj.childNodes[j].className = 'auto_onmouseout';

                        } else {

                            _this.autoObj.childNodes[j].className = 'auto_onmouseover';

                        }

                    }

                }

            },

            //更改classname

            changeClassname: function (length) {

                for (var i = 0; i < length; i++) {

                    if (i != this.index) {

                        this.autoObj.childNodes[i].className = 'auto_onmouseout';

                    } else {

                        this.autoObj.childNodes[i].className = 'auto_onmouseover';

                        this.obj.value = this.autoObj.childNodes[i].seq;

                    }

                }

            }

            ,

            //响应键盘

            pressKey: function (event) {

                var length = this.autoObj.children.length;

                //光标键"↓"

                if (event.keyCode == 40) {

                    ++this.index;

                    if (this.index > length) {

                        this.index = 0;

                    } else if (this.index == length) {

                        this.obj.value = this.search_value;

                    }

                    this.changeClassname(length);

                }

                //光标键"↑"

                else if (event.keyCode == 38) {

                    this.index--;

                    if (this.index < -1) {

                        this.index = length - 1;

                    } else if (this.index == -1) {

                        this.obj.value = this.search_value;

                    }

                    this.changeClassname(length);

                }

                //回车键

                else if (event.keyCode == 13) {

                    this.autoObj.className = "auto_hidden";

                    this.index = -1;

                } else {

                    this.index = -1;

                }

            },

            //程序入口

            start: function (event) {

                if (event.keyCode != 13 && event.keyCode != 38 && event.keyCode != 40) {

                    this.init();

                    this.deleteDIV();

                    this.search_value = this.obj.value;

                    var valueArr = this.value_arr;

                    valueArr.sort();

                    if (this.obj.value.replace(/(^\s*)|(\s*$)/g, '') == "") {
                        return;
                    }//值为空，退出

                    try {
                        var reg = new RegExp("(" + this.obj.value + ")", "i");
                    }

                    catch (e) {
                        return;
                    }

                    var div_index = 0;//记录创建的DIV的索引

                    for (var i = 0; i < valueArr.length; i++) {

                        if (reg.test(valueArr[i])) {

                            var div = document.createElement("div");

                            div.className = "auto_onmouseout";

                            div.seq = valueArr[i];

                            div.onclick = this.setValue(this);

                            div.onmouseover = this.autoOnmouseover(this, div_index);

                            div.innerHTML = valueArr[i].replace(reg, "<strong>$1</strong>");//搜索到的字符粗体显示

                            this.autoObj.appendChild(div);

                            this.autoObj.className = "auto_show";

                            div_index++;

                        }

                    }

                }

                this.pressKey(event);

                window.onresize = Bind(this, function () {
                    this.init();
                });

            }

        }

        //-->

    </script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.css' rel='stylesheet'/>
</head>

<body>
<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.css'
      type='text/css'/>
<div class="width">
    <div style="width:1480px; clear:both;">
        <div style="height:60px;width:800px; background:url(images/lk_02.jpg); padding:15px 0 0 680px;">
            <div class="shous">
                <input type="file" name="uploadCSV" id="upCsv" style="height:36px">
                <input id="ajaxSubmit" type="button" value="更新文件" style="width:80px;height:22px">
                <input type="text" id="o" placeholder="搜索" onkeyup="autoComplete.start(event)">
                <button id="shen" type="button">&nbsp</button>
            </div>
            <div class="auto_hidden" id="auto"><!--自动完成 DIV--></div>
        </div>


        <div>
            <div style="width:175px; height:720px; float:left; overflow-y:auto; overflow-x:hidden;">
                <ul class="accordion" id="accordion">
                    <li id="one" class="files"><a href="#one">Metro line 1</a>
                        <ul class="sub-menu">

                        </ul>
                    </li>
                    <li id="two" class="mail"><a href="#two">Metro line 2</a>
                        <ul class="sub-menu">

                        </ul>
                    </li>
                    <li id="three" class="cloud"><a href="#three">Metro line 3</a>
                        <ul class="sub-menu">

                        </ul>
                    </li>
                    <li id="four" class="sign"><a href="#four">Metro line 4</a>
                        <ul class="sub-menu">

                        </ul>
                    </li>
                    <li id="fiv" class="fiv"><a href="#fiv">Metro line 5</a>
                        <ul class="sub-menu">

                        </ul>
                    </li>
                    <li id="six" class="six"><a href="#six">Metro line 7</a>
                        <ul class="sub-menu">

                        </ul>
                    </li>
                    <li id="seven" class="seven"><a href="#seven">Metro line 9</a>
                        <ul class="sub-menu">

                        </ul>
                    </li>
                    <li id="eight" class="eight"><a href="#eight">Metro line 11</a>
                        <ul class="sub-menu">

                        </ul>
                    </li>
                </ul>
            </div>
            <div style="width:900px; height:730px; float:left" id="map1">
            </div>
            <div style="width:405px; height:730px; float:left; background:url(images/lk_024.jpg) repeat-y;">
                <div style="width:400px; height:500px; padding-left:5px;" id="map2">
                </div>
                <div style="width:395px; height:220px; margin-left:7px;  background:url(images/lk_25.jpg) repeat-x; padding-top:10px;" id="mapDiv">
                    <div class="tip top" style="height:120px" id="yesterday"></div>

                </div>
            </div>
        </div>
    </div>
</div>
<script>

    var autoComplete = new AutoComplete('o', 'auto', ['慈善机构', '网络科技', '户外用品', '公证鉴定机构', '银行相关', '公司', '东北菜', '永和豆浆', '其它农林牧渔基地', '社会团体相关', '上海银行', '清真菜馆', '超市', '中国进出口银行', '农副产品市场', '品牌箱包店', '高等院校', '国家开发银行', '电信公司', '林场', '外国餐厅', '口腔医院', '公园景点售票处', '音乐厅', '娱乐场所', '经济型连锁酒店', '摄影冲印', '旅行社', '科教文化场所', '广发银行', '兴业银行', '耐克专卖店', '楼宇相关', '国美', '上海浦东发展银行', '中国人寿保险公司', '国税机关', '城市广场', '冶金化工', '知名企业', '自动提款机', '数码电子', '广告装饰', '垂钓园', '其它亚洲菜', '剧场', '棋牌室', '四星级宾馆', '甜品店', '健身中心', '中式素菜馆', '售票处', '文化用品店', '火车票代售点', '五星级宾馆', '茶艺馆', '共青团', '体育休闲服务场所', '购物中心', '汇丰银行', '银行', '浙江菜', '工业大厦建筑物', '迪厅', '音像店', '篮球场馆', '马会投注站', '住宅小区', '海鲜酒楼', '湖北菜(鄂菜)', '医疗保健用品', '中国人民保险公司', '评估事务所', '家居建材市场', '诊所', '金融保险机构', '俄国菜', '药房', '疾病预防', '公交卡/月票代售点', '高尔夫球场', '地税机关', '站台', '殡仪馆', '出站口', '中介机构', '上海菜', '博物馆', '行业协会', '水族馆', '摩托车服务相关', '长途汽车票代售点', '交通执法站', '上海商业银行', '日本三菱东京日联银行', '户外健身场所', '机场出发/到达', '露营地', '花卉市场', '溜冰场', '服务中心', '班车站', '中学', '传媒机构', '荷兰银行', '二手车交易', 'KTV', '招商银行', '水上活动中心', '意式菜品餐厅', '品牌服装店', '莎莎', '中国电信营业厅', '政府及社会团体相关', '建筑公司', '汽车维修', '乡镇级政府及事业单位', '证券营业厅', '儿童用品店', '乐购', '台球厅', '货运港口码头', '残联', '海滨浴场', '华夏银行', '火锅店', '社会治安机构', '文化宫', '渣打银行', '海滩', '传染病医院', '机场相关', '出入口', '公安制证', '中餐厅', '汽车救援', '百佳超市', '牛扒店(扒房)', '公司企业', '钟表店', '商务写字楼', '国家级景点', '综合市场', '工商部门', '北京银行', '中国移动香港', '学校', '宠物诊所', '票务相关', '出版社', '轻轨站', '潮州菜', '书店', '骨科医院', '家电电子卖场', '中国建设银行', '屈臣氏', '中国铁通营业厅', '锐步专卖店', '中国移动营业厅', '大中', '文艺团体', '船票代售点', '拍卖行', '电讯营业厅', '酒吧', '省级景点', '布艺市场', '美式风味', '审计事务所', '加油站', '综合酒楼', '旧货市场', '苏宁', '充电站', '检察院', '车辆管理机构', '民主党派', '中国民生银行', '妇科医院', '山东菜(鲁菜)', '杂志社', '公墓', '出租车', '足球场', '客运港', '公安警察', '冷饮店', '肿瘤医院', '社区中心', '天文馆', '摄影器材店', '邮政速递', '过境口岸', '普通商场', '消费者协会', '老字号', '高尔夫相关', '深圳农村商业银行', '地中海风格菜品', '特色商业街', '急救中心', '楼宇', '安徽菜(徽菜)', '报社', '家乐福', '游乐场', '风景名胜', '医药公司', '综合家电商场', '美容美发店', '法院', '交通车辆管理相关', '永亨银行', '商住两用楼宇', '外国机构相关', '德国菜', '三星级宾馆', '礼品饰品店', '科研机构', '教堂', '科技馆', '湖南菜(湘菜)', '羽毛球场', '汽车俱乐部', '别墅', '保龄球馆', '会计师事务所', '疗养院', '区县级政府及事业单位', '平安银行', '蔬菜市场', '青年旅舍', '必胜客', '事务所', '沃尔玛', '公园', '中信银行', '香港星展银行', '家具城', '物流速递', '停车场入口', '胸科医院', '福建菜', '农村商业银行', '图书馆', '室内展位', '苏格兰皇家银行', '消防机关', '其它个人用品店', '三级甲等医院', '幼儿园', '香港恒生银行', '江苏菜', '少先队', '大众银行(香港)', '四川菜(川菜)', '美心', '宠物市场', '果品市场', '红十字会', '灯具瓷器市场', '餐饮相关', '土特产专卖店', '职业技术学校', '法式菜品餐厅', '其它能源站', '长途汽车站', '信息咨询中心', '教会', '中国人民银行', '摩托车维修', '花鸟鱼虫市场', '中国农业银行', '宿舍', '美术馆', '体育用品店', '展览馆', '交通服务相关', '轮渡站', '火车站', '壁球场', '步行街', '糕饼店', '搬家公司', '星巴克咖啡', '小商品市场', '麦德龙', '加气站', '植物园', '公园广场', '高尔夫用品店', '宝马生活方式', '公园内部设施', '观景点', '古玩字画店', '网吧', '会展中心', '墨西哥菜', '华泰财产保险股份有限公司', '农场', '跆拳道场馆', '中国光大银行', '洗浴推拿场所', '仙跡岩', '综合医院', '机场货运处', '整形美容', '免税品店', '水果基地', '韩国料理', '影剧院相关', '脑科医院', '综合体育馆', '工商税务机构', '烟酒专卖店', '汽车养护/装饰', '旅馆招待所', '商务住宅相关', '快餐厅', '邮局', '洗车场', '公共停车场', '专营店', '英国式菜品餐厅', '矿产公司', '学校内部设施', '电力营业厅', '便民商店/便利店', '大家乐', '丧葬设施', '档案馆', '品牌鞋店', '卫生院', '机械电子', '珠宝首饰工艺品', '专用停车场', '中国太平洋保险', '动物医疗场所', '货运火车站', '动物园', '驾校', '生活服务场所', '乒乓球馆', '飞机票代售点', '手机销售', '自来水营业厅', '泰康人寿保险公司', '眼科医院', '商场', '中国邮政储蓄银行', '国家级机关及事业单位', '工厂', '大快活', '成人教育', '培训机构', '摩根大通银行', '高尔夫练习场', '茶餐厅', '物流仓储场地', '水产海鲜市场', '寺庙道观', '港口码头', '泰国/越南菜品餐厅', '洗衣店', '候机室', '产业园区', '广东菜(粤菜)', '西北菜', '采摘园', '中国工商银行', '外国使领馆', '眼镜店', '北京菜', '台湾菜', '交通银行', '网球场', '医疗保健服务场所', '人才市场', '公交车站相关', '休闲餐饮场所', '休闲场所', '夜总会', '度假疗养场所', '退票', '汽车配件销售', '建材五金市场', '乡镇以下级政府及事业单位', '典当行', '小学', '花旗银行', '纪念馆', '婴儿服务场所', '外地政府办', '花卉苗圃基地', '中国联通营业厅', '游泳馆', '巴西菜', '牧场', '汽车服务相关', '售票', '飞机场', '服装鞋帽皮具店', '香港永隆银行', '蔬菜基地', '住宅区', '回教寺', '品牌皮具店', '南洋商业银行', '公检法机关', '阿迪达斯专卖店', 'Pacific Coffee Company', '万宁超市', '宾馆酒店', '妇联', '咖啡厅', '电台', '滑雪场', '地市级政府及事业单位', '电视台', '华润', '律师事务所', '政府机关相关', '家禽养殖基地', '保险公司', '中国平安保险公司', '中国再保险公司', '大新银行', '陵园', '赛马场', '省直辖市级政府及事业单位', '西餐厅(综合风味)', '婴儿游泳馆', '购物相关场所', '专利事务所', '财务公司', '交通管理机构', '精神病医院', '中国银行', '东亚银行', 'OK便利店', '日本料理', '特色/地方风味餐厅', '彩票彩券销售点', '摩托车销售', '汽车销售', '马术俱乐部', '云贵菜', '商业贸易', '认证事务所', '直升机场', '新华人寿保险公司', '麦当劳', '运动场所', '电影院', '停车场相关', '人渡口', '特殊买卖场所', '印度风味', '自行车专卖店', '医药保健相关', '候车室', '游戏厅', '改签', '进站口/检票口', '证券公司', '兽医站', '彪马专卖店', '路边停车场', '上岛咖啡', '停车场出口', '吉野家', '度假村', '停车场出入口', '7-ELEVEn便利店', '家具建材综合市场', '李宁专卖店', '旅游景点', '验车场', '肯德基', '地铁站', '专科医院', '宠物用品店', '住宿服务相关', '耳鼻喉医院', '汽车租赁', '维修站点', '厨卫市场']);

</script>
<script src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>


<script type="text/javascript">
    $(document).ready(function () {
        // Store variables
        var accordion_head = $('.accordion > li > a'),
            accordion_body = $('.accordion li > .sub-menu');
        // Open the first tab on load
        accordion_head.first().addClass('active').next().slideDown('normal');
        // Click function
        accordion_head.on('click', function (event) {
            // Disable header links
            event.preventDefault();
            // Show and hide the tabs on click
            if ($(this).attr('class') != 'active') {
                accordion_body.slideUp('normal');
                $(this).next().stop(true, true).slideToggle('normal');
                accordion_head.removeClass('active');
                $(this).addClass('active');
            }
        });
    });
</script>
<script>
    var line1 = ['罗湖', '国贸', '老街', '大剧院', '科学馆', '华强路', '岗厦', '会展中心', '购物公园', '香蜜湖', '车公庙', '竹子林', '侨城东', '华侨城', '世界之窗', '白石洲', '高新园', '深大', '桃园', '大新', '鲤鱼门', '前海湾', '新安', '宝安中心', '宝体', '坪洲', '西乡', '固戍', '后瑞', '机场东']
    var line2 = ['赤湾', '蛇口港', '海上世界', '水湾', '东角头', '湾厦', '海月', '登良', '后海', '科苑', '红树湾', '世界之窗', '侨城北', '深康', '安托山', '侨香', '香蜜', '香梅北', '景田', '莲花西', '福田', '市民中心', '岗厦北', '华强北', '燕南', '大剧院', '湖贝', '黄贝岭', '新秀']
    var line3 = ['益田', '石厦', '购物公园', '福田', '少年宫', '莲花村', '华新', '通新岭', '红岭', '老街', '晒布', '翠竹', '田贝', '水贝', '草埔', '布吉', '木棉湾', '大芬', '丹竹头', '六约', '塘坑', '横岗', '永湖', '荷坳', '大运', '爱联', '吉祥', '龙城广场', '南联', '双龙']
    var line4 = ['清湖', '龙华', '龙胜', '上塘', '红山', '深圳北站', '白石龙', '民乐', '上梅林', '莲花北', '福田口岸', '福民', '市民中心', '少年宫']
    var line5 = ['前海湾', '临海', '宝华', '宝安中心', '翻身', '灵芝', '洪浪北', '兴东', '留仙洞', '西丽', '大学城', '塘朗', '长岭陂', '深圳北站', '民治', '五和', '坂田', '杨美', '上水径', '下水径', '长龙', '布吉', '百鸽笼', '布心', '太安', '怡景', '黄贝岭']
    var line7 = ['西丽湖', '西丽', '茶光', '珠光', '龙井', '桃源村', '深云', '安托山', '农林', '车公庙', '上沙', '沙尾', '石厦', '皇岗村', '福民', '皇岗口岸', '赤尾', '华强南', '华强北', '华新', '黄木岗', '八卦岭', '红岭北', '笋岗', '洪湖', '田贝', '太安']
    var line9 = ['深湾', '深圳湾公园', '下沙', '车公庙', '香梅', '景田', '梅景', '下梅林', '梅村', '上梅林', '孖岭', '银湖', '泥岗', '红岭北', '园岭', '红岭', '红岭南', '鹿丹村', '人民南', '向西村', '文锦']
    var line11 = ['红树湾南', '后海', '南山', '前海湾', '宝安', '碧海湾', '机场', '机场北', '福永', '桥头', '塘尾', '马安山', '沙井', '后亭', '松岗', '碧头']

    var lis = document.getElementsByTagName("li");
    var length = lis.length
    var liss = $("#accordion >li>ul").eq(0)

    var lii = ''
    for (var i = 0; i < line1.length; i++) {
        lii = lii + '<li><a href=\"#\">' + line1[i] + '</a></li>\n'
    }
    liss.html(lii)

    var liss2 = $("#accordion >li>ul").eq(1)
    var lii2 = ''
    for (var i = 0; i < line2.length; i++) {
        lii2 = lii2 + '<li><a href=\"#\">' + line2[i] + '</a></li>\n'
    }
    liss2.html(lii2)

    var liss3 = $("#accordion >li>ul").eq(2)
    var lii3 = ''
    for (var i = 0; i < line3.length; i++) {
        lii3 = lii3 + '<li><a href=\"#\">' + line3[i] + '</a></li>\n'
    }
    liss3.html(lii3)

    var liss4 = $("#accordion >li>ul").eq(3)
    var lii4 = ''
    for (var i = 0; i < line4.length; i++) {
        lii4 = lii4 + '<li><a href=\"#\">' + line4[i] + '</a></li>\n'
    }
    liss4.html(lii4)

    var liss5 = $("#accordion >li>ul").eq(4)
    var lii5 = ''
    for (var i = 0; i < line5.length; i++) {
        lii5 = lii5 + '<li><a href=\"#\">' + line5[i] + '</a></li>\n'
    }
    liss5.html(lii5)

    var liss6 = $("#accordion >li>ul").eq(5)
    var lii6 = ''
    for (var i = 0; i < line7.length; i++) {
        lii6 = lii6 + '<li><a href=\"#\">' + line7[i] + '</a></li>\n'
    }
    liss6.html(lii6)

    var liss9 = $("#accordion >li>ul").eq(6)
    var lii9 = ''
    for (var i = 0; i < line9.length; i++) {
        lii9 = lii9 + '<li><a href=\"#\">' + line9[i] + '</a></li>\n'
    }
    liss9.html(lii9)

    var liss11 = $("#accordion >li>ul").eq(7)
    var lii11 = ''
    for (var i = 0; i < line11.length; i++) {
        lii11 = lii11 + '<li><a href=\"#\">' + line11[i] + '</a></li>\n'
    }
    liss11.html(lii11)


</script>
<script>
    var chaige = 0;
    var chaige1 = 0;
    var shange = 0;
    getSemeticData('华强南');

    var labeldata = {
        "type": "FeatureCollection",
        "crs": {"type": "name", "properties": {"name": "EPSG:4326"}},
        "features": []
    }

    $.ajax({
        url: "./static/data/166subway.json",
        type: "GET",
        dataType: "json",
        success: function (data1) {

            map1.addSource('geodataPolygon', {type: 'geojson', data: data1});

            map1.addLayer({
                "id": "polygonlayer11",
                "type": "fill",
                "source": "geodataPolygon",
                "paint": {

                    "fill-color": "#fbb03b",
                    'fill-opacity': 0.4
                }
            });
            //高亮显示图层
            map1.addLayer({
                "id": "selectLayer",
                "type": "fill",
                "source": "geodataPolygon",
                "paint": {
                    "fill-color": "#ff2b3b",
                    "fill-opacity": 0.4
                },
                "filter": ["in", "Field1", ""]
            });
        }
    });


    $('.accordion > li > ul > li > a').click(function () {
        var place = $(this).html();


        $.ajax({
            url: "./static/data/166subway.json",
            type: "GET",
            dataType: "json",
            success: function (data1) {
                var features1 = data1.features
                var geofeature = features1.filter(function (e) {
                    return e.properties['Field1'] == place
                });
                var evecoord = geofeature[0].geometry.coordinates[0]

                var poly = turf.polygon([evecoord])
                var geocenter = turf.centroid(poly)
                lat = geocenter.geometry.coordinates[0]
                lng = geocenter.geometry.coordinates[1]
                map1.setCenter([lat, lng]);
                map1.setZoom(14)

            }
        });

        // var eve = datae.features[i].geometry.coordinates[0];
        //     var polygon = turf.polygon([eve]);
        //     var center = turf.centroid(polygon);

        map1.setFilter('selectLayer', ["in", "Field1", place]);


        map1.on('click','selectLayer',function(e){
            var b =document.getElementById("yesterday")
            b.innerHTML="Station：" + e.features[0].properties['Field1'] + '<br />' +
                "Area(sq.km.):" + e.features[0].properties['Area_sq_km'] + '<br />' +
                "Total POI types:" + e.features[0].properties['Total_POI_'] + '<br />' + "Total POIs：" + e.features[0].properties['Total_POIs'] + '<br />' +
                "Density of POIs(/sq.km.):" + (e.features[0].properties['Density_of']).toFixed(2)

        })
        map1.on('mouseenter', 'selectLayer', function (e) {
            map1.getCanvas().style.cursor = 'pointer';

        });
        map1.on('mouseleave', 'selectLayer', function () {
            map1.getCanvas().style.cursor = '';
            popup.remove();
        });
        getSemeticData(place);
        setTimeout(updateArea, 1000)


    });

    mapboxgl.accessToken = 'pk.eyJ1Ijoibmlld3poIiwiYSI6ImNqbjRvM2F4ODA5ZDEzd2xkd2oxZnB4Y2UifQ.phMvmLw9t9lDxobKyYVbPw';
    var mapStyle = {
        "version": 8,
        "name": "Dark",
        "sources": {
            "mapbox": {
                "type": "vector",
                "url": "mapbox://mapbox.mapbox-streets-v8"
            },
        },
        "sprite": "mapbox://sprites/mapbox/dark-v10",
        "glyphs": "mapbox://fonts/mapbox/{fontstack}/{range}.pbf",
        "layers": []
    };
    var map1 = new mapboxgl.Map({
        container: 'map2',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [114.080, 22.547],
        zoom: 9
    });


    var map = new mapboxgl.Map({
        container: 'map1',
        zoom: 3.2,
        center: [0, 0],
        style: mapStyle,
        minZoom: 3.2
    });

    //点击侧边栏查询 by niewenzheng

    $('#shen').click(function () {
        var content = document.getElementById('o').value
        $.ajax({
            url: "./static/data/sem488.json",
            type: "GET",
            dataType: "json",
            success: function (data1) {
                var features1 = data1.features;
                var geofeature = features1.filter(function (e) {
                    return e.properties['type'] == content
                });
                var lat = geofeature[0].geometry.coordinates[0]
                var lng = geofeature[0].geometry.coordinates[1]
                map.setCenter([lat, lng]);
                map.setZoom(7)
            }
        });

    });

    var draw = new MapboxDraw({
        displayControlsDefault: false,
        controls: {
            polygon: true,
            trash: true
        }
    });
    map.addControl(draw);

    map.on('draw.create', updateArea);
    map.on('draw.delete', updateArea);
    map.on('draw.update', updateArea);

    function updateArea() {
        var datae = draw.getAll();

        labeldata = {
            "type": "FeatureCollection",
            "crs": {"type": "name", "properties": {"name": "EPSG:4326"}},
            "features": []
        }

        // var datt=datae.features[0].geometry['coordinates'];


        if (chaige1 % 2 == 1) {
            map.removeLayer("labellayer");
            map.removeSource("label");
            chaige1 = 0
        }
        chaige1++;
        for (var i = 0; i < datae.features.length; i++) {
            var value1 = 0;
            var eve = datae.features[i].geometry.coordinates[0];
            var polygon = turf.polygon([eve]);
            var center = turf.centroid(polygon);

            var userPolygon = datae.features[i];
            var polygonBoundingBox = turf.bbox(userPolygon);
            var southWest = [polygonBoundingBox[0], polygonBoundingBox[1]];
            var northEast = [polygonBoundingBox[2], polygonBoundingBox[3]];
            var northEastPointPixel = map.project(northEast);
            var southWestPointPixel = map.project(southWest);
            var features = map.queryRenderedFeatures([southWestPointPixel, northEastPointPixel], {layers: ['pointslayer']});
            features.reduce(function (memo, feature) {
                if (!(undefined === turf.intersect(feature, userPolygon))) {
                    // only add the property, if the feature intersects with the polygon drawn by the user
                    memo.push(feature.properties.FID);
                    var intnum = parseInt(feature.properties['value']);
                    value1 = value1 + intnum
                }
                return memo;
            }, ['in', 'FID']);
            // value11.push(value1)
            // console.log(value11)

            center.properties['newvalue'] = value1;


            labeldata['features'].push(center);

        }
        map.addSource('label', {type: 'geojson', data: labeldata});

        map.addLayer({
            "id": "labellayer",
            "type": "symbol",
            "source": "label",
            "layout": {
                "text-field": "{newvalue}",
                "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
                "text-anchor": "top"
            },
            "paint": {
                "text-color": "#a81d1c"
            }
        });
    }


    map.on("zoom", onMapZoom);

    //确定缩放等级与label关系
    function onMapZoom() {
        if (map.getZoom() < 3.4) {
            var a = map.style._layers;
            if ("32pointlayer" in a) {
                map.setLayoutProperty("32pointlayer", 'visibility', 'none');
            }
            if ("488pointlayer" in a) {
                map.setLayoutProperty("488pointlayer", 'visibility', 'none');
            }
            if (map.getLayoutProperty('13pointlayer', 'visibility') === 'none') {
                map.setLayoutProperty("13pointlayer", 'visibility', 'visible');
            }

        } else if (map.getZoom() >= 3.4 && map.getZoom() <= 4.1) {
            var b = map.style._layers;
            if ("13pointlayer" in b) {
                map.setLayoutProperty("13pointlayer", 'visibility', 'none');
            }
            if ("488pointlayer" in b) {
                map.setLayoutProperty("488pointlayer", 'visibility', 'none');
            }
            if (map.getLayoutProperty('32pointlayer', 'visibility') === 'none') {
                map.setLayoutProperty("32pointlayer", 'visibility', 'visible');
            }
        } else if (map.getZoom() > 4.1) {
            var c = map.style._layers;
            if ("13pointlayer" in c) {
                map.setLayoutProperty("13pointlayer", 'visibility', 'none');
            }
            if ("32pointlayer" in c) {
                map.setLayoutProperty("32pointlayer", 'visibility', 'none');
            }
            if (map.getLayoutProperty('488pointlayer', 'visibility') === 'none') {
                map.setLayoutProperty("488pointlayer", 'visibility', 'visible');
            }
        }
    }


    //Load Semetic Message
    function getSemeticData(place) {

        $.ajax({
            url: "./static/data/local_poi.json",//json文件位置
            type: "GET",//请求方式为get
            dataType: "json", //返回数据格式为json
            success: function (data1) {//请求成功完成后要执行的方法
                menu_label = data1.filter(function (e) {
                    return e[' 位置'] == place
                });
                rendererSemeticPoints(menu_label)
            }
        });
    }


    $("#ajaxSubmit").click(function (e) {
        var data0 = [];
        var objj = {};
        var data2 = []
        var data4 = []
        var fileType = $('#upCsv').val().split('.');
        var files = document.getElementById("upCsv").files;

        $("#ajaxSubmit").attr("disabled", "disabled");
        // 判断上传的文件类型

        if ((fileType[fileType.length - 1]) === 'csv' || (fileType[fileType.length - 1]) === 'CSV' || (fileType[fileType.length - 1]) === 'xlsx' || (fileType[fileType.length - 1]) === 'XLSX') {

            var files = document.getElementById("upCsv").files;

            if (files.length) {
                var file = files[0];
                var reader = new FileReader(); //new一个FileReader实例
                if (typeof FileReader == 'undefined') {
                    alert("你的浏览器暂不支持该功能", {title: "提示", skin: "layui-layer-molv"});
                    file.setAttribute("disabled", "disabled");
                    return;
                }
                reader.readAsText(file);
                reader.onload = function () {
                    var num = null;
                    var relArr = this.result.split("\r\n");

                    if (!$.isEmptyObject(relArr) && relArr.length > 1) {


                        var value1 = relArr[0]
                        if (!$.isEmptyObject(value1)) {
                            var objArr1 = value1.split(",");
                            data0 = objArr1

                        }
                        var value2 = relArr[1]
                        if (!$.isEmptyObject(value2)) {

                            var objArr2 = value2.split("\"");
                            var objAttr4 = objArr2[0].split(",")
                            data4 = eval(objAttr4)
                            if (!(undefined == data4[488])) {
                                var objAttr5 = eval(objArr2[1])
                                var objAttr6 = objAttr5[0]
                                var poly1 = turf.polygon([objAttr6])
                                var geocenter1 = turf.centroid(poly1)
                                lat1 = geocenter1.geometry.coordinates[0]
                                lng1 = geocenter1.geometry.coordinates[1]
                                map1.setCenter([lat1, lng1]);
                                map1.setZoom(14)
                                var tou = {
                                    'type': 'Feature',
                                    'geometry': {
                                        'type': 'Polygon',
                                    }
                                }
                                var geo = tou['geometry']
                                geo['coordinates'] = objAttr5
                                if (shange % 2 == 1) {
                                    map1.removeLayer("yonghu");
                                    map1.removeSource("zidingyi");
                                    shange = 0
                                }
                                shange++;
                                map1.addSource('zidingyi', {type: 'geojson', data: tou});

                                map1.addLayer({
                                    "id": "yonghu",
                                    "type": "fill",
                                    "source": "zidingyi",
                                    "paint": {
                                        "fill-color": "#1e3dfb",
                                        'fill-opacity': 0.4
                                    }
                                });
                                console.log(data0)
                                console.log(data4)
                                for (i = 0; i < data0.length - 1; i++) {
                                    objj[data0[i]] = data4[i]
                                }

                            } else {
                                alert("kong")
                                for (i = 0; i < data0.length; i++) {
                                    objj[data0[i]] = data4[i]
                                }
                                map1.setCenter([106, 32]);
                                map1.setZoom(2)
                            }

                        }

                    }

                    data2.push(objj)
                    rendererSemeticPoints(data2)

                    $("#ajaxSubmit").removeAttr("disabled");
                }
            }
        } else {
            alert("请上传.csv或.xlsx文件");
            $("#ajaxSubmit").removeAttr("disabled");
        }

    })


    //渲染points of Semetic Map
    function rendererSemeticPoints(values) {
        if (chaige % 2 == 1) {
            map.removeLayer("488pointlayer");
            map.removeSource("488point")
            map.removeLayer("13pointlayer")
            map.removeSource("13point")
            map.removeLayer("32pointlayer")
            map.removeSource("32point")
            map.removeLayer("pointslayer")
            map.removeSource("geodataPoint")
            chaige = 0
        }
        chaige++;
        setTimeout(function () {
            $.ajax({
                url: "./static/data/13point.json",//json文件位置
                type: "GET",//请求方式为get
                dataType: "json", //返回数据格式为json
                success: function (data1) {//请求成功完成后要执行的方法
                    //each循环 使用$.each方法遍历返回的数据date

                    map.addSource('13point', {type: 'geojson', data: data1});

                    map.addLayer({
                        "id": "13pointlayer",
                        "type": "symbol",
                        "source": "13point",
                        "layout": {
                            "text-field": "{type}",
                            "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
                            "text-anchor": "top"
                        }

                    });
                }
            });
        }, 100);
        setTimeout(function () {
            $.ajax({
                url: "./static/data/32point.json",//json文件位置
                type: "GET",//请求方式为get
                dataType: "json", //返回数据格式为json
                success: function (data1) {//请求成功完成后要执行的方法
                    //each循环 使用$.each方法遍历返回的数据date
                    map.addSource('32point', {type: 'geojson', data: data1});
                    map.addLayer({
                        "id": "32pointlayer",
                        "type": "symbol",
                        "source": "32point",
                        "layout": {
                            "text-field": "{type}",
                            "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
                            "text-anchor": "top",
                            "visibility": "none"
                        }
                    });
                    if (map.getZoom() < 3.4) {
                        var a = map.style._layers;
                        if ("32pointlayer" in a) {
                            map.setLayoutProperty("32pointlayer", 'visibility', 'none');
                        }
                        if (map.getLayoutProperty('13pointlayer', 'visibility') === 'none') {
                            map.setLayoutProperty("13pointlayer", 'visibility', 'visible');
                        }

                    } else if (map.getZoom() >= 3.4 && map.getZoom() <= 4.1) {
                        var b = map.style._layers;
                        if ("13pointlayer" in b) {
                            map.setLayoutProperty("13pointlayer", 'visibility', 'none');
                        }

                        if (map.getLayoutProperty('32pointlayer', 'visibility') === 'none') {
                            map.setLayoutProperty("32pointlayer", 'visibility', 'visible');
                        }
                    } else if (map.getZoom() > 4.1) {
                        var c = map.style._layers;
                        if ("13pointlayer" in c) {
                            map.setLayoutProperty("13pointlayer", 'visibility', 'none');
                        }
                        if ("32pointlayer" in c) {
                            map.setLayoutProperty("32pointlayer", 'visibility', 'none');
                        }

                    }
                }
            });
        }, 200);

        setTimeout(function () {
            $.ajax({
                url: "./static/data/sem488.json",//json文件位置
                type: "GET",//请求方式为get
                dataType: "json", //返回数据格式为json
                success: function (data1) {//请求成功完成后要执行的方法
                    //each循环 使用$.each方法遍历返回的数据date
                    map.addSource('488point', {type: 'geojson', data: data1});
                    map.addLayer({
                        "id": "488pointlayer",
                        "type": "symbol",
                        "source": "488point",
                        "layout": {
                            "text-field": "{type}",
                            "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
                            "text-anchor": "top",
                            "visibility": "none"
                        }

                    });
                    if (map.getZoom() < 3.4) {
                        var a = map.style._layers;
                        if ("32pointlayer" in a) {
                            map.setLayoutProperty("32pointlayer", 'visibility', 'none');
                        }
                        if ("488pointlayer" in a) {
                            map.setLayoutProperty("488pointlayer", 'visibility', 'none');
                        }
                        if (map.getLayoutProperty('13pointlayer', 'visibility') === 'none') {
                            map.setLayoutProperty("13pointlayer", 'visibility', 'visible');
                        }

                    } else if (map.getZoom() >= 3.4 && map.getZoom() <= 4.1) {
                        var b = map.style._layers;
                        if ("13pointlayer" in b) {
                            map.setLayoutProperty("13pointlayer", 'visibility', 'none');
                        }
                        if ("488pointlayer" in b) {
                            map.setLayoutProperty("488pointlayer", 'visibility', 'none');
                        }
                        if (map.getLayoutProperty('32pointlayer', 'visibility') === 'none') {
                            map.setLayoutProperty("32pointlayer", 'visibility', 'visible');
                        }
                    } else if (map.getZoom() > 4.1) {
                        var c = map.style._layers;
                        if ("13pointlayer" in c) {
                            map.setLayoutProperty("13pointlayer", 'visibility', 'none');
                        }
                        if ("32pointlayer" in c) {
                            map.setLayoutProperty("32pointlayer", 'visibility', 'none');
                        }
                        if (map.getLayoutProperty('488pointlayer', 'visibility') === 'none') {
                            map.setLayoutProperty("488pointlayer", 'visibility', 'visible');
                        }
                    }
                }
            });
        }, 300)
        $.ajax({
            url: "./static/data/sem488.json",
            type: "GET",
            dataType: "json",
            success: function (data11) {
                var features = data11['features']
                var shuzu = [];
                for (i = 0; i < features.length; i++) {
                    var num1 = features[i].properties['type'];
                    var properties = features[i].properties;
                    properties['value'] = parseInt(values[0][num1])
                    shuzu.push(Math.log(parseInt(values[0][num1]) + 1) / Math.log(Math.E))
                    properties['valueln'] = Math.log(parseInt(values[0][num1]) + 1) / Math.log(Math.E)
                }

                var max = Math.max.apply(null, shuzu);
                var max1 = 0.2 * max;
                var max2 = 0.4 * max;
                var max3 = 0.6 * max;
                var max4 = 0.8 * max;


                map.addSource('geodataPoint', {type: 'geojson', data: data11});
                map.addLayer({
                    "id": "pointslayer",
                    "type": "circle",
                    "source": "geodataPoint",
                    "paint": {
                        'circle-radius':
                            ['+', ['ln', ['+', ['get', 'value'], 1]], 3],
                        "circle-color": [
                            'interpolate',
                            ['linear'],
                            ['get', 'valueln'],
                            0, "#fbf894",
                            max1, "#fba10c",
                            max2, "#db523a",
                            max3, "#962765",
                            max4, "#420c64",
                            max, "#000005"

                        ],
                        'circle-opacity': 0.75
                    }
                });

                map.on('click', 'pointslayer', function (e) {
                    new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML("POI类型：" + e.features[0].properties['type'] + '<br />' + "POI数量：" + e.features[0].properties['value'] + '<br />')
                        .addTo(map);
                });
                map.on('mouseenter', 'pointslayer', function () {
                    map.getCanvas().style.cursor = 'pointer';
                });


                map.on('mouseleave', 'pointslayer', function () {
                    map.getCanvas().style.cursor = '';
                })

            }
        });
    }
</script>
</body>
</html>
